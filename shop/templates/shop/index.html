{% extends 'shop/basic.html' %}
    {% block title %}TechComputers Shop{% endblock %}
    {% block home %}active{% endblock%}
    {% block css %}
        .carousel-control-prev,
        .carousel-control-next{
            top:100px;
            width:130px;
            right: -49px;
          }
          .w-100 {
            height: 600px;
          }
          body .carousel-control-prev-icon,
          body .carousel-control-next-icon{
            background-color: black;
          }
          .carousel-control-prev{
            left: -49px;
          }
         .d-flex {
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
          }

        .align-center {
          -webkit-box-align: center;
          -ms-flex-align: center;
          align-items: center;
        }

        .flex-centerY-centerX {
          justify-content: center;
          -webkit-box-pack: center;
          -ms-flex-pack: center;
          justify-content: center;
          -webkit-box-align: center;
          -ms-flex-align: center;
          align-items: center;
        }

        .page-wrapper {
          height: 100%;
          display: table;
        }

        .page-wrapper .page-inner {
          display: table-cell;
          vertical-align: middle;
        }

        .el-wrapper {
          width: 360px;
          padding: 15px;
          margin: 15px auto;
          background-color: #fff;
        }

        @media (max-width: 991px) {
          .el-wrapper {
            width: 345px;
          }
        }

        @media (max-width: 767px) {
          .el-wrapper {
            width: 290px;
            margin: 30px auto;
          }
        }

        .el-wrapper:hover .h-bg {
          left: 0px;
        }

        .el-wrapper:hover .price {
          left: 20px;
          -webkit-transform: translateY(-50%);
          -ms-transform: translateY(-50%);
          -o-transform: translateY(-50%);
          transform: translateY(-50%);
          color: #818181;
        }

        .el-wrapper:hover .add-to-cart {
          left: 50%;
        }

        .el-wrapper:hover .img {
          webkit-filter: blur(7px);
          -o-filter: blur(7px);
          -ms-filter: blur(7px);
          filter: blur(7px);
          filter: progid:DXImageTransform.Microsoft.Blur(pixelradius='7', shadowopacity='0.0');
          opacity: 0.4;
        }

        .el-wrapper:hover .info-inner {
          bottom: 155px;
        }

        .el-wrapper:hover .a-size {
          -webkit-transition-delay: 300ms;
          -o-transition-delay: 300ms;
          transition-delay: 300ms;
          bottom: 50px;
          opacity: 1;
        }

        .el-wrapper .box-down {
          width: 100%;
          height: 60px;
          position: relative;
          overflow: hidden;
        }

        .el-wrapper .box-up {
          width: 100%;
          height: 300px;
          position: relative;
          overflow: hidden;
          text-align: center;
        }

        .el-wrapper .img {
          padding: 20px 0;
          -webkit-transition: all 800ms cubic-bezier(0, 0, 0.18, 1);
          -moz-transition: all 800ms cubic-bezier(0, 0, 0.18, 1);
          -o-transition: all 800ms cubic-bezier(0, 0, 0.18, 1);
          transition: all 800ms cubic-bezier(0, 0, 0.18, 1);
          /* ease-out */
          -webkit-transition-timing-function: cubic-bezier(0, 0, 0.18, 1);
          -moz-transition-timing-function: cubic-bezier(0, 0, 0.18, 1);
          -o-transition-timing-function: cubic-bezier(0, 0, 0.18, 1);
          transition-timing-function: cubic-bezier(0, 0, 0.18, 1);
          /* ease-out */
        }

        .h-bg {
          -webkit-transition: all 800ms cubic-bezier(0, 0, 0.18, 1);
          -moz-transition: all 800ms cubic-bezier(0, 0, 0.18, 1);
          -o-transition: all 800ms cubic-bezier(0, 0, 0.18, 1);
          transition: all 800ms cubic-bezier(0, 0, 0.18, 1);
          /* ease-out */
          -webkit-transition-timing-function: cubic-bezier(0, 0, 0.18, 1);
          -moz-transition-timing-function: cubic-bezier(0, 0, 0.18, 1);
          -o-transition-timing-function: cubic-bezier(0, 0, 0.18, 1);
          transition-timing-function: cubic-bezier(0, 0, 0.18, 1);
          /* ease-out */
          width: 660px;
          height: 100%;
          background-color: #3f96cd;
          position: absolute;
          left: -659px;
        }

        .h-bg .h-bg-inner {
          width: 50%;
          height: 100%;
          background-color: #464646;
        }

        .info-inner {
          -webkit-transition: all 400ms cubic-bezier(0, 0, 0.18, 1);
          -moz-transition: all 400ms cubic-bezier(0, 0, 0.18, 1);
          -o-transition: all 400ms cubic-bezier(0, 0, 0.18, 1);
          transition: all 400ms cubic-bezier(0, 0, 0.18, 1);
          /* ease-out */
          -webkit-transition-timing-function: cubic-bezier(0, 0, 0.18, 1);
          -moz-transition-timing-function: cubic-bezier(0, 0, 0.18, 1);
          -o-transition-timing-function: cubic-bezier(0, 0, 0.18, 1);
          transition-timing-function: cubic-bezier(0, 0, 0.18, 1);
          /* ease-out */
          position: absolute;
          width: 100%;
          bottom: 25px;
        }

        .info-inner .p-name,
        .info-inner .p-company {
          display: block;
        }

        .info-inner .p-name {
          font-family: 'PT Sans', sans-serif;
          font-size: 18px;
          color: #252525;
        }

        .info-inner .p-company {
          font-family: 'Lato', sans-serif;
          font-size: 15px;
          text-transform: uppercase;
          color: #FFE11B;
        }

        .a-size {
          -webkit-transition: all 300ms cubic-bezier(0, 0, 0.18, 1);
          -moz-transition: all 300ms cubic-bezier(0, 0, 0.18, 1);
          -o-transition: all 300ms cubic-bezier(0, 0, 0.18, 1);
          transition: all 300ms cubic-bezier(0, 0, 0.18, 1);
          /* ease-out */
          -webkit-transition-timing-function: cubic-bezier(0, 0, 0.18, 1);
          -moz-transition-timing-function: cubic-bezier(0, 0, 0.18, 1);
          -o-transition-timing-function: cubic-bezier(0, 0, 0.18, 1);
          transition-timing-function: cubic-bezier(0, 0, 0.18, 1);
          /* ease-out */
          position: absolute;
          width: 100%;
          bottom: -20px;
          font-family: 'PT Sans', sans-serif;
          color: #828282;
          opacity: 0;
        }

        .a-size .size {
          color: #252525;
        }

        .cart {
          display: block;
          position: absolute;
          width: 100%;
          height: 100%;
          top: 0;
          left: 0;
          font-family: 'Lato', sans-serif;
          font-weight: 700;
        }

        .cart .price {
          -webkit-transition: all 600ms cubic-bezier(0, 0, 0.18, 1);
          -moz-transition: all 600ms cubic-bezier(0, 0, 0.18, 1);
          -o-transition: all 600ms cubic-bezier(0, 0, 0.18, 1);
          transition: all 600ms cubic-bezier(0, 0, 0.18, 1);
          /* ease-out */
          -webkit-transition-timing-function: cubic-bezier(0, 0, 0.18, 1);
          -moz-transition-timing-function: cubic-bezier(0, 0, 0.18, 1);
          -o-transition-timing-function: cubic-bezier(0, 0, 0.18, 1);
          transition-timing-function: cubic-bezier(0, 0, 0.18, 1);
          /* ease-out */
          -webkit-transition-delay: 100ms;
          -o-transition-delay: 100ms;
          transition-delay: 100ms;
          display: block;
          position: absolute;
          top: 50%;
          left: 50%;
          -webkit-transform: translate(-50%, -50%);
          -ms-transform: translate(-50%, -50%);
          -o-transform: translate(-50%, -50%);
          transform: translate(-50%, -50%);
          font-size: 16px;
          color: #252525;
        }

        .cart .add-to-cart {
          -webkit-transition: all 600ms cubic-bezier(0, 0, 0.18, 1);
          -moz-transition: all 600ms cubic-bezier(0, 0, 0.18, 1);
          -o-transition: all 600ms cubic-bezier(0, 0, 0.18, 1);
          transition: all 600ms cubic-bezier(0, 0, 0.18, 1);
          /* ease-out */
          -webkit-transition-timing-function: cubic-bezier(0, 0, 0.18, 1);
          -moz-transition-timing-function: cubic-bezier(0, 0, 0.18, 1);
          -o-transition-timing-function: cubic-bezier(0, 0, 0.18, 1);
          transition-timing-function: cubic-bezier(0, 0, 0.18, 1);
          /* ease-out */
          -webkit-transition-delay: 100ms;
          -o-transition-delay: 100ms;
          transition-delay: 100ms;
          display: block;
          position: absolute;
          top: 50%;
          left: 110%;
          -webkit-transform: translate(-50%, -50%);
          -ms-transform: translate(-50%, -50%);
          -o-transform: translate(-50%, -50%);
          transform: translate(-50%, -50%);
        }

        .cart .add-to-cart .txt {
          font-size: 12px;
          color: #fff;
          letter-spacing: 0.045em;
          text-transform: uppercase;
          white-space: nowrap;
        }
        * {
          box-sizing: border-box;
        }

        /* Create three equal columns that floats next to each other */
        .column {
          float: left;
          width: 33.33%;
          padding: 10px;
          height: 300px; /* Should be removed. Only for demonstration */
        }

        /* Clear floats after the columns */
        .row:after {
          content: "";
          display: table;
          clear: both;
        }

        /* Responsive layout - makes the three columns stack on top of each other instead of next to each other */
        @media screen and (max-width: 600px) {
          .column {
            width: 100%;
          }
        }
        .valpr{
          color:white;
        }
        .divpr{
          margin-left:20px;
        }
{% endblock %}
 
{% block body %}
{% load static %}
  <div id="carouselExampleFade" class="carousel slide carousel-fade" data-ride="carousel">
    <div class="carousel-inner">
      <div class="carousel-item active">
        <img src="/static/shop/sale1.jpg" class="d-block w-100" alt="Sale1">
      </div>
      <div class="carousel-item">
        <img src="/static/shop/sale2.jpg" class="d-block w-100" alt="...">
      </div>
      <div class="carousel-item">
        <img src="/static/shop/sale3.jpg" class="d-block w-100" alt="...">
      </div>
    </div>
    <a class="carousel-control-prev" href="#carouselExampleFade" role="button" data-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="sr-only" hidden>Previous</span>
    </a>
    <a class="carousel-control-next" href="#carouselExampleFade" role="button" data-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="sr-only" hidden>Next</span>
    </a>
  </div>



<div class="container">

<div class="row">
<h2>Recommanded Products:</h2>
  {%for product, range in allProds%}
    
  {% for i in product %}
  <!-- card1 -->
  <div class="column my-5">
    <div class="container page-wrapper" style="width: 450px;">
      <div class="page-inner">
        <div class="row">
          <div class="el-wrapper">
            <div class="box-up">
              <a href="/shop/products/{{i.id}}">
              <img class="img" src="/media/{{i.image}}" alt="/media/{{i.image}}" id="imagepr{{i.id}}" height="300px" width="300px">
              </a>
              <div class="img-info">
                <div class="info-inner">
                  <span style="background-color:#08050a; color:yellow;"class="p-company" id="namepr{{i.id}}">{{i.product_name}}</span>
                </div>
                <div class="a-size">{{i.desc|slice:"0:53"}}...</div>
              </div>
            </div>

            <div class="box-down">
              <div class="h-bg">
                <div class="h-bg-inner"></div>
              </div>

               <span class="cart" >
               <p class="card-text price">â‚¹
              <span id="pricepr{{i.id}}">{{i.price}}</span></p>
              <button class="add-to-cart btn divpr" id="divpr{{i.id}}">
              <span class="txt cart" id="pr{{i.id}}">Add in cart</span>
              </button>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
<!-- card1 end -->
 {% if forloop.counter|divisibleby:"3" %}
    </div>
    <div class="row my-4">
      <br><br><br><br><br>
{% endif %}
  {% endfor %}
  {% endfor %}
</div>
</div>
{% endblock %}
{% block js %} 
<script>
//find out the item from localStorage
if (localStorage.getItem('cart') == null) {
    var cart = {};
} else {
    cart = JSON.parse(localStorage.getItem('cart'));
   
    updateCart(cart);
}
// If the add to cart button is clicked, add/increment the item
//$('.cart').click(function() {
$('.divpr').on('click', 'span.cart', function() {
    var idstr = this.id.toString();
    if (cart[idstr] != undefined) {
        qty = cart[idstr][0] + 1;
        
    } else {
        qty = 1;
        name = document.getElementById('name'+idstr).innerHTML
        price = document.getElementById('price'+idstr).innerHTML
        image = document.getElementById('image'+idstr).getAttribute('alt');
        cart[idstr] = [qty, name, price, image];
        console.log(cart);
    }
    updateCart(cart);
});

//add popover to cart
$('#popcart').popover();
{% comment %} document.getElementById("popcart").setAttribute('data-content', '<h5>Cart for your items in my shopping cart</h5>'); {% endcomment %}
updatePopover(cart);

function updatePopover(cart)
{
  
    var popStr = '';
    popStr = popStr + '<h5> Cart for your items </h5><div class="mx-2 my-2">';
    var i = 1;
    for (var item in cart){
        popStr = popStr + '<b>' + i + '</b>. ';
        popStr = popStr + document.getElementById('name' + item).innerHTML.slice(0, 19) + '... Qty: ' + cart[item][0] + '<br>';
        i = i+1;
    }
    popStr = popStr + '</div> <a href="/shop/checkout"><button class="btn btn-primary " id="checkout">Checkout</button></a><button class="btn btn-primary mx-2" id="clearCart" onclick="clearCart()">Clear Cart</button>';
    document.getElementById('popcart').setAttribute('data-content', popStr);
    $('#popcart').popover('show');
}

function clearCart(){
  cart=JSON.parse(localStorage.getItem('cart'));
  for (var item in cart){
    document.getElementById('div'+item).innerHTML = '<button id="'+ item +'" class="btn btn-primary cart">Add to Cart</button>'
  }
  localStorage.clear();
  cart = {};
  updateCart(cart);
}

function updateCart(cart) {
    var sum = 0;
    for (var item in cart) {
        sum = sum + cart[item][0];
        document.getElementById('div' + item).innerHTML = "<button id='minus"+ item +"' class='btn btn-primary minus'>-</button> <span class='valpr' id='val" + item + "''>" + cart[item][0] + "</span> <button id='plus" + item + "' class='btn btn-primary plus'> + </button>";
    }
    localStorage.setItem('cart', JSON.stringify(cart));
    document.getElementById('cart').innerHTML = sum;
    console.log(cart);
    updatePopover(cart);
}

$('.divpr').on("click", "button.minus", function() {
    a = this.id.slice(7, );
    cart['pr' + a][0] = cart['pr' + a][0] - 1;
    cart['pr' + a][0] = Math.max(0, cart['pr' + a][0]);
    if (cart['pr' + a][0] == 0){
        document.getElementById('divpr' + a).innerHTML = '<button class="add-to-cart btn divpr" id="divpr'+a+'"><span class="txt cart" id="pr'+a+'">Add in cart</span></button>';
        delete cart['pr'+a];
    }
    else{
        document.getElementById('valpr' + a).innerHTML = cart['pr' + a][0];
    }
    updateCart(cart);

});

$('.divpr').on("click", "button.plus", function() {
    a = this.id.slice(6, );
    cart['pr' + a][0] = cart['pr' + a][0] + 1;
    document.getElementById('valpr' + a).innerHTML = cart['pr' + a][0];
    updateCart(cart);
});
</script>

{% endblock %}
